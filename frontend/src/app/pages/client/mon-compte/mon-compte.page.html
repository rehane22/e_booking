  <div class="max-w-6xl mx-auto">
    <div class="flex items-center justify-between mt-4">
      <h1 class="text-2xl font-semibold">Mon compte</h1>
      <a class="btn-ghost h-10" routerLink="/services">← Catalogue</a>
    </div>

    <!-- ======= INFOS PERSONNELLES ======= -->
    <section class="card p-6 mt-6">
      <h2 class="text-lg font-semibold">Informations personnelles</h2>
      <p class="text-sm text-muted mb-4">Modifie tes informations (l’email n’est pas modifiable).</p>

      <form class="grid md:grid-cols-2 gap-4" (ngSubmit)="save()" autocomplete="off">
        <div>
          <label class="text-xs">Prénom</label>
          <input class="input h-10 w-full" [(ngModel)]="form.prenom" name="prenom" required>
        </div>
        <div>
          <label class="text-xs">Nom</label>
          <input class="input h-10 w-full" [(ngModel)]="form.nom" name="nom" required>
        </div>
        <div>
          <label class="text-xs">Téléphone</label>
          <input class="input h-10 w-full" [(ngModel)]="form.telephone" name="telephone" placeholder="+336...">
        </div>
        <div>
          <label class="text-xs">Email</label>
          <input class="input h-10 w-full opacity-70 pointer-events-none" [value]="me?.email" disabled>
        </div>

        <div class="md:col-span-2 flex gap-2 mt-2">
          <button class="btn-primary h-11 px-6" type="submit" [disabled]="saving">
            @if (!saving) { Enregistrer } @else { <span class="opacity-80">Enregistrement…</span> }
          </button>
          <button type="button" class="btn-ghost h-11" (click)="reset()" [disabled]="saving">Réinitialiser</button>
        </div>

        @if (saveError) {
          <div class="md:col-span-2 text-sm text-red-600 mt-2">{{ saveError }}</div>
        }
        @if (saveOk) {
          <div class="md:col-span-2 text-sm text-emerald-600 mt-2">Profil mis à jour.</div>
        }
      </form>
    </section>

    <!-- ======= MES RENDEZ-VOUS (style aligné sur la page pro) ======= -->
    @if (!has('ADMIN')) {
      <section class="card p-6 mt-6 space-y-6">
        <div class="flex items-center justify-between">
          <h2 class="text-lg font-semibold">Mes rendez-vous</h2>
          <div class="text-sm text-muted">
            @if (rdvs.length) { {{ rdvs.length }} RDV } @else { Aucun RDV }
          </div>
        </div>

        <!-- Filtres -->
        <form [formGroup]="filters" (ngSubmit)="apply()" class="flex flex-wrap gap-3 items-end">
          <div>
            <label class="text-xs">Date</label>
            <input type="date" class="input" formControlName="date">
          </div>
          <div>
            <label class="text-xs">Statut</label>
            <select class="input" formControlName="statut">
              <option [ngValue]="''">Tous</option>
              <option [ngValue]="'EN_ATTENTE'">En attente</option>
              <option [ngValue]="'CONFIRME'">Confirmé</option>
              <option [ngValue]="'ANNULE'">Annulé</option>
              <option [ngValue]="'REFUSE'">Refusé</option>
            </select>
          </div>
          <button class="btn-ghost h-10" type="submit">Filtrer</button>
          <button class="btn-ghost h-10" type="button" (click)="clear()">Réinitialiser</button>
        </form>

        <!-- À venir -->
        <div class="p-6 rounded-2xl border border-black/10">
          <h3 class="font-semibold mb-3">À venir</h3>
          <div class="space-y-3">
            @for (r of futurs; track r.id) {
              <div class="p-4 rounded-2xl border border-black/10">
                <div class="flex items-start justify-between gap-3">
                  <div>
                    <div class="font-medium">
                      {{ r.serviceLabel }}
                    </div>
                    <div class="text-sm text-black/70">
                      {{ r.dateLabel }} — {{ r.heure }} → {{ r.heureFin }} · {{ r.prestataireLabel }}
                    </div>
                    <div class="mt-2 flex items-center gap-2">
                      <span class="badge" [ngClass]="r.badgeClass">{{ labelStatut(r.statut) }}</span>
                      <span class="text-[11px] px-2 py-0.5 rounded-full border"
                            [ngClass]="badgeTempsClasses(r)">
                        {{ badgeTempsLabel(r) }}
                      </span>
                    </div>
                  </div>

                  <div class="flex gap-2 shrink-0">
                    <a class="btn-ghost h-9" [routerLink]="['/prestataires', r.prestataireId]">Voir prestataire</a>
                    @if (r.statut !== 'ANNULE' && r.statut !== 'REFUSE') {
                      <button class="btn-ghost h-9 text-red-600"
                              (click)="cancel(r)"
                              [disabled]="cancelingId === r.id">
                        @if (cancelingId === r.id) { Annulation… } @else { Annuler }
                      </button>
                    }
                  </div>
                </div>
              </div>
            } @empty {
              <div class="text-sm text-muted">Aucun rendez-vous à venir.</div>
            }
          </div>
        </div>

        <!-- Passés (repliables) -->
        <div class="p-6 rounded-2xl border border-black/10">
          <div class="flex items-center justify-between">
            <h3 class="font-semibold">Passés</h3>
            <button class="btn-ghost h-9" (click)="pastOpen=!pastOpen">
              {{ pastOpen ? 'Masquer' : 'Afficher' }}
            </button>
          </div>

          @if (pastOpen) {
            <div class="space-y-3 mt-3">
              @for (r of passes; track r.id) {
                <div class="p-4 rounded-2xl border border-black/10">
                  <div class="flex items-start justify-between gap-3">
                    <div>
                      <div class="font-medium">{{ r.serviceLabel }}</div>
                      <div class="text-sm text-black/70">
                        {{ r.dateLabel }} — {{ r.heure }} → {{ r.heureFin }} · {{ r.prestataireLabel }}
                      </div>
                      <div class="mt-2">
                        <span class="badge" [ngClass]="r.badgeClass">{{ labelStatut(r.statut) }}</span>
                      </div>
                    </div>
                    <div class="flex gap-2 shrink-0">
                      <a class="btn-ghost h-9" [routerLink]="['/prestataires', r.prestataireId]">Voir prestataire</a>
                    </div>
                  </div>
                </div>
              } @empty {
                <div class="text-sm text-muted">Aucun historique.</div>
              }
            </div>
          }
        </div>

        @if (listError) {
          <div class="text-sm text-red-600">{{ listError }}</div>
        }
      </section>
    }
  </div>