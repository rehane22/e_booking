  <div class="max-w-5xl mx-auto">
    <div class="flex items-center justify-between mt-4">
      <h1 class="text-2xl font-semibold">Prestataire</h1>
      <button class="btn-ghost h-10" routerLink="/services">← Retour au catalogue</button>
    </div>


    <section class="card p-6 mt-6 flex flex-col md:flex-row gap-5 md:items-center">
      <div class="h-20 w-20 rounded-2xl grid place-items-center text-white font-semibold text-xl"
           [ngClass]="avatarBg(id)">
        {{ initials(name) }}
      </div>
      <div class="flex-1">
        <p class="text-xl font-medium">{{ name }}</p>
        <p class="text-sm text-muted">
          @if (specialite) { {{ specialite }} }
        </p>
      </div>
    </section>


    <section id="about" class="card p-6 mt-4">
      <h3 class="font-semibold mb-2">À propos</h3>
      <div class="space-y-1 text-sm text-muted">
        <p>Adresse : <b>{{ adresse || '—' }}</b></p>
        <p>Spécialité : <b>{{ specialite || '—' }}</b></p>
      </div>
    </section>


    <section id="slots" class="card p-6 mt-4">
      <div class="flex items-baseline justify-between gap-3 flex-wrap">
        <h3 class="font-semibold">Créneaux disponibles</h3>
        <div class="text-sm text-muted"><b>{{ name }}</b></div>
      </div>


      <div class="grid sm:grid-cols-4 gap-3 mt-4">
        <div>
          <label class="text-xs">Date</label>
          <input class="input h-10 w-full"
                 type="date"
                 [(ngModel)]="date"
                 [attr.min]="todayISO"
                 (ngModelChange)="onFiltersChange()">
        </div>

        <div class="sm:col-span-2">
          <label class="text-xs">Service (obligatoire)</label>
          <select class="input h-10 w-full" [(ngModel)]="serviceId" (ngModelChange)="onFiltersChange()">
            <option [ngValue]="null" disabled>— Sélectionner —</option>
            @for (s of services; track s.id) {
              <option [ngValue]="s.id">{{ s.nom }}</option>
            } @empty {
              <option [ngValue]="null" disabled>Aucun service lié</option>
            }
          </select>
        </div>

        <div>
          <label class="text-xs">Durée</label>
          <select class="input h-10 w-full" [(ngModel)]="dureeMin" (ngModelChange)="recomputeGridMask()">
            <option [ngValue]="15">15 min</option>
            <option [ngValue]="30">30 min</option>
            <option [ngValue]="45">45 min</option>
            <option [ngValue]="60">1 h</option>
            <option [ngValue]="75">1 h 15</option>
            <option [ngValue]="90">1 h 30</option>
            <option [ngValue]="105">1 h 45</option>
            <option [ngValue]="120">2 h</option>
          </select>
        </div>
      </div>


      <div class="mt-2 text-sm text-muted">
        @if (heureDebut) {
          <span>Aperçu : <b>{{ heureDebut }}</b> → <b>{{ heureFinPreview() }}</b> ({{ dureeMin }} min)</span>
        } @else {
          <span>Sélectionne une heure de début ci-dessous</span>
        }
      </div>


      <div class="grid grid-cols-2 md:grid-cols-4 gap-2 mt-4">
        @for (t of grid; track t) {
          <button
            class="h-10 rounded-xl border transition-colors px-3 text-sm"
            [ngClass]="slotClasses(t)"
            [disabled]="!isStartReservable(t)"
            [attr.aria-pressed]="t === heureDebut"
            (click)="selectStart(t)">
            {{ t }}
          </button>
        } @empty {
          <div class="text-sm text-muted col-span-full">Aucun créneau disponible.</div>
        }
      </div>


      <div class="mt-3 text-xs text-muted flex gap-4 items-center">
        <span class="inline-flex items-center gap-2">
          <span class="inline-block w-3 h-3 rounded bg-primary"></span> Sélectionné
        </span>
        <span class="inline-flex items-center gap-2">
          <span class="inline-block w-3 h-3 rounded bg-gray-200"></span> Indisponible (réservé/chevauchement/passé)
        </span>
      </div>


      <div class="mt-4 flex flex-wrap gap-2">
        <button class="btn-primary h-11 px-6"
                [disabled]="!canReserve() || loading"
                (click)="reserve()">
          @if (!loading) { Réserver }
          @else { <span class="opacity-80">Réservation…</span> }
        </button>
        <button class="btn-ghost h-11" (click)="resetSelection()" [disabled]="!heureDebut || loading">Réinitialiser</button>
      </div>

      @if (errorText) {
        <div class="mt-3 text-sm text-red-600">{{ errorText }}</div>
      }
      @if (successText) {
        <div class="mt-3 text-sm text-emerald-600">{{ successText }}</div>
      }
    </section>
  </div>